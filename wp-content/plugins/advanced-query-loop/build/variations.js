!function(){"use strict";var e={d:function(t,a){for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}};e.d({},{y:function(){return w}});var t=window.wp.blocks,a=window.wp.i18n,r=window.wp.element,n=window.wp.hooks,l=window.wp.blockEditor,o=window.wp.components;const u=e=>{let{attributes:t,setAttributes:n}=e;const{query:{perPage:l,offset:u=0}={}}=t;return(0,r.createElement)(o.PanelBody,{title:(0,a.__)("Post Count","advanced-query-loop")},(0,r.createElement)(o.RangeControl,{label:(0,a.__)("Posts Per Page","advanced-query-loop"),min:1,max:50,onChange:e=>{n({query:{...t.query,perPage:e,offset:u}})},value:l}))},d=e=>{let{attributes:t,setAttributes:n}=e;const{query:{offset:l=0}={}}=t;return(0,r.createElement)(o.PanelBody,{title:(0,a.__)("Post Offset","advanced-query-loop")},(0,r.createElement)(o.__experimentalNumberControl,{label:(0,a.__)("Offset","advanced-query-loop"),value:l,min:0,onChange:e=>{n({query:{...t.query,offset:e}})}}))};var c={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let y;const i=new Uint8Array(16);function s(){if(!y&&(y="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!y))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return y(i)}const m=[];for(let e=0;e<256;++e)m.push((e+256).toString(16).slice(1));var p=function(e,t,a){if(c.randomUUID&&!t&&!e)return c.randomUUID();const r=(e=e||{}).random||(e.rng||s)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){a=a||0;for(let e=0;e<16;++e)t[a+e]=r[e];return t}return function(e,t=0){return(m[e[t+0]]+m[e[t+1]]+m[e[t+2]]+m[e[t+3]]+"-"+m[e[t+4]]+m[e[t+5]]+"-"+m[e[t+6]]+m[e[t+7]]+"-"+m[e[t+8]]+m[e[t+9]]+"-"+m[e[t+10]]+m[e[t+11]]+m[e[t+12]]+m[e[t+13]]+m[e[t+14]]+m[e[t+15]]).toLowerCase()}(r)},_=window.wp.coreData;const q=["=","!=",">",">=","<","<=","LIKE","NOT LIKE","IN","NOT IN","BETWEEN","NOT BETWEEN","NOT EXISTS","REGEXP","NOT REGEXP","RLIKE"],v=e=>{var t;let{registeredMetaKeys:n,id:l,queries:u,metaKey:d,metaValue:c,metaCompare:y,attributes:i,setAttributes:s}=e;const m=u.find((e=>e.id===l)),p=(e,t,a,r)=>e.map((e=>e.id===t?{...e,[a]:r}:e));return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(o.BaseControl,{help:(0,a.__)("Start typing to search for a meta key or manually enter one.","advanced-query-loop")},(0,r.createElement)(o.FormTokenField,{label:(0,a.__)("Meta Key","advanced-query-loop"),value:null!=m&&null!==(t=m.meta_key)&&void 0!==t&&t.length?[m.meta_key]:[],__experimentalShowHowTo:!1,suggestions:n,maxLength:1,onChange:e=>{s({query:{...i.query,meta_query:{...i.query.meta_query,queries:p(u,l,"meta_key",e[0])}}})}})),(0,r.createElement)(o.TextControl,{label:(0,a.__)("Meta Value","advanced-query-loop"),value:m.meta_value,onChange:e=>{s({query:{...i.query,meta_query:{...i.query.meta_query,queries:p(u,l,"meta_value",e)}}})}}),(0,r.createElement)(o.SelectControl,{label:(0,a.__)("Meta Compare","advanced-query-loop"),value:m.meta_compare,options:[...q.map((e=>({label:e,value:e})))],onChange:e=>{s({query:{...i.query,meta_query:{...i.query.meta_query,queries:p(u,l,"meta_compare",e)}}})}}),(0,r.createElement)(o.Button,{isSmall:!0,variant:"secondary",isDestructive:!0,onClick:()=>{const e=u.filter((e=>e.id!==l));s({query:{...i.query,meta_query:{...i.query.meta_query,queries:e}}})}},(0,a.__)("Remove meta query","advanced-query-loop")))},E=e=>{var t;let{attributes:n,setAttributes:l}=e;const{query:{postType:u,meta_query:{relation:d="",queries:c=[]}={}}={}}=n,{records:y}=(0,_.useEntityRecords)("postType",u,{per_page:1}),[i]=(0,r.useState)(u),s=(null==y||null===(t=y[0])||void 0===t?void 0:t.meta)||{};return(0,r.useEffect)((()=>{u!==i&&l({query:{...n.query,meta_query:{}}})}),[u]),(0,r.createElement)(o.PanelBody,{title:(0,a.__)("Post Meta Query","advanced-query-loop")},(0,r.createElement)(r.Fragment,null,c.length>1&&(0,r.createElement)(o.SelectControl,{label:(0,a.__)("Query Relationship","advanced-query-loop"),value:d,options:[{label:"Choose relationship",value:""},{label:"AND",value:"AND"},{label:"OR",value:"OR"}],onChange:e=>l({query:{...n.query,meta_query:{...n.query.meta_query,relation:e}}})}),c.length<1&&(0,r.createElement)("p",null,(0,a.__)("Add a meta query to select post meta to query","advanced-query-loop")),c.map((e=>{let{id:t,meta_key:a,meta_value:u,compare:d}=e;return(0,r.createElement)(o.PanelBody,{key:t},(0,r.createElement)(v,{id:t,metaKey:a,metaValue:u,metaCompare:d,registeredMetaKeys:Object.keys(s),queries:c,attributes:n,setAttributes:l}))})),(0,r.createElement)(o.Button,{isSmall:!0,variant:"primary",onClick:()=>{const e=[...c,{id:p(),meta_key:"",meta_value:"",meta_compare:""}];l({query:{...n.query,meta_query:{...n.query.meta_query,queries:e}}})}},(0,a.__)("Add meta query","advanced-query-loop"))))},b=e=>{let{attributes:t,setAttributes:n}=e;const{query:{date_query:{relation:l="",date_primary:u=new Date,date_secondary:d=new Date,inclusive:c=!1}={}}={}}=t;return(0,r.createElement)(o.PanelBody,{title:(0,a.__)("Post Date Query","advanced-query-loop")},(0,r.createElement)(o.SelectControl,{label:(0,a.__)("Date Relationship","advanced-query-loop"),value:l,options:[{label:"None",value:""},{label:"Before",value:"before"},{label:"After",value:"after"},{label:"Between",value:"between"}],onChange:e=>{n({query:{...t.query,date_query:""!==e?{...t.query.date_query,relation:e}:""}})}}),""!==l&&(0,r.createElement)(r.Fragment,null,"between"===l&&(0,r.createElement)("h4",null,(0,a.__)("Start date","advanced-query-loop")),(0,r.createElement)(o.DatePicker,{currentDate:u,onChange:e=>{n({query:{...t.query,date_query:{...t.query.date_query,date_primary:e}}})}}),"between"===l&&(0,r.createElement)(r.Fragment,null,(0,r.createElement)("h4",null,(0,a.__)("End date","advanced-query-loop")),(0,r.createElement)(o.DatePicker,{currentDate:d,onChange:e=>{n({query:{...t.query,date_query:{...t.query.date_query,date_secondary:e}}})}})),(0,r.createElement)("br",null),(0,r.createElement)(o.CheckboxControl,{label:(0,a.__)("Include selected date(s)","advanced-query-loop"),help:(0,a.__)("Should the selected date(s) be included in your query?","advanced-query-loop"),checked:c,onChange:e=>{n({query:{...t.query,date_query:{...t.query.date_query,inclusive:e}}})}})))};var g=window.wp.data;const f=e=>{let{attributes:t,setAttributes:n}=e;const{query:{multiple_posts:l=[],postType:u}={}}=t,d=(0,g.useSelect)((e=>{var t,a;return null===(t=e(_.store).getPostTypes())||void 0===t||null===(a=t.filter((e=>{let{viewable:t}=e;return t})))||void 0===a?void 0:a.map((e=>{let{slug:t}=e;return t}))}));return d?(0,r.createElement)(o.PanelBody,{title:(0,a.__)("Additional Post Types","advanced-query-loop")},(0,r.createElement)(o.BaseControl,{help:(0,a.__)("These post types will be queried in addition to the main post type.","advanced-query-loop")},(0,r.createElement)(o.FormTokenField,{value:[...l.filter((e=>e!==u))],suggestions:[...null==d?void 0:d.filter((e=>e!==u))],onChange:e=>{n({query:{...t.query,multiple_posts:e||[]}})},__experimentalExpandOnFocus:!0,__experimentalShowHowTo:!1}))):(0,r.createElement)(o.PanelBody,{title:(0,a.__)("Additional Post Types","advanced-query-loop")},(0,a.__)("Loadingâ€¦","advanced-query-loop"))},h=e=>{let{attributes:t,setAttributes:n}=e;const{query:{order:l,orderBy:u}={}}=t;return(0,r.createElement)(o.PanelBody,{title:(0,a.__)("Post Order","advanced-query-loop")},(0,r.createElement)(o.SelectControl,{label:(0,a.__)("Order By","advanced-query-loop"),value:u,help:"meta_value"===u||"meta_value_num"===u?(0,a.__)("Meta Value and Meta Value Num require that Meta Key is set in the Meta Query section.","advanced-query-loop"):"",options:[{label:(0,a.__)("Author","advanced-query-loop"),value:"author"},{label:(0,a.__)("Date","advanced-query-loop"),value:"date"},{label:(0,a.__)("Last Modified Date","advanced-query-loop"),value:"modified"},{label:(0,a.__)("Title","advanced-query-loop"),value:"title"},{label:(0,a.__)("Meta Value","advanced-query-loop"),value:"meta_value"},{label:(0,a.__)("Meta Value Num","advanced-query-loop"),value:"meta_value_num"},{label:(0,a.__)("Random","advanced-query-loop"),value:"rand"},{label:(0,a.__)("Menu Order","advanced-query-loop"),value:"menu_order"}],onChange:e=>{n({query:{...t.query,orderBy:e}})}}),(0,r.createElement)(o.ToggleControl,{label:(0,a.__)("Ascending Order","advanced-query-loop"),checked:"asc"===l,onChange:()=>{n({query:{...t.query,order:"asc"===l?"desc":"asc"}})}}))};(0,n.addFilter)("editor.BlockEdit","core/query",(e=>t=>{if((e=>{const{attributes:{namespace:t}}=e;return t&&t===w})(t)){const{attributes:a}=t;return!1===a.query.inherit?(0,r.createElement)(r.Fragment,null,(0,r.createElement)(e,t),(0,r.createElement)(l.InspectorControls,null,(0,r.createElement)(f,t),(0,r.createElement)(u,t),(0,r.createElement)(d,t),(0,r.createElement)(h,t),(0,r.createElement)(E,t),(0,r.createElement)(b,t))):(0,r.createElement)(r.Fragment,null,(0,r.createElement)(e,t),(0,r.createElement)(l.InspectorControls,null,(0,r.createElement)(u,t),(0,r.createElement)(h,t)))}return(0,r.createElement)(e,t)}));const w="advanced-query-loop";(0,t.registerBlockVariation)("core/query",{name:w,title:(0,a.__)("Advanced Query Loop","advanced-query-loop"),description:(0,a.__)("Create advanced queries","advanced-query-loop"),icon:function(){return(0,r.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 221.3 111.6"},(0,r.createElement)("text",{fill:"#e76f51",fontFamily:"Montserrat-Bold, Montserrat",fontSize:"100",transform:"translate(.9 85)"},(0,r.createElement)("tspan",{x:"0",y:"0",letterSpacing:"0em"},"A"),(0,r.createElement)("tspan",{x:"75.6",y:"0",letterSpacing:"0em"},"QL")))},isActive:["namespace"],attributes:{namespace:w},scope:["inserter","transform"]})}();